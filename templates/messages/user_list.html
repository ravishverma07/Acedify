{% extends 'base.html' %}

{% block content %}
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Bootstrap demo</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
    </head>
    <body>
      <div>
        <h1 style="color: white;">Welcome, {{ current_user.username }}!</h1>
        <div>
  {% if current_user.semester and current_user.semester != 'none' %}
    <p style="color: white;">Your current semester: {{ current_user.semester }}</p>
    <form method="POST" style="display: inline;">
      {% csrf_token %}
      <label for="semester" style="color: white;">Update Semester:</label>
      <select name="semester" id="semester" required>
        <option value="" disabled>Select Semester</option>
        {% for key, value in semester_choices %}
          <option value="{{ key }}" {% if current_user.semester == key %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">Update</button>
    </form>
  {% else %}
    <form method="POST">
      {% csrf_token %}
      <label for="semester" style="color: white;">Select Semester:</label>
      <select name="semester" id="semester" required>
        <option value="" disabled selected>Select Semester</option>
        {% for key, value in semester_choices %}
          <option value="{{ key }}">{{ value }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  {% endif %}
</div>

      </div>

      <h2 style="color:white ;">Available Users</h2>
      <ul style="display: flex; flex-wrap: wrap; gap: 1rem; list-style: none; padding: 0;">
        {% for profile in profiles %}
    <li>
      <div class="card" style="width: 18rem;">
        <div class="card-body">
          <h5 class="card-title">{{ profile.username }}</h5>
          <h6 class="card-subtitle mb-2 text-body-secondary">{{ profile.college }}</h6>
          <p class="card-text">{{ profile.semester }} - sem</p>
          <a href="{% url 'chat' profile.username %}" class="btn btn-primary">Message</a>
          {% if profile.new_messages_count > 0 %}
            <p class="text-danger mt-2">{{ profile.new_messages_count }} new messages</p>
          {% endif %}
        </div>
      </div>
    </li>
  {% endfor %}
      </ul>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    </body>
  </html>
{% endblock %}
